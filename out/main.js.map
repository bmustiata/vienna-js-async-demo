{"version":3,"sources":["webpack:///webpack/bootstrap 6d2908dfd72a0874e91e","webpack:///external \"babel-polyfill\"","webpack:///./src/server/main.js","webpack:///./src/shared/Model.js","webpack:///external \"express\"","webpack:///external \"uuid\"","webpack:///external \"express-ws\""],"names":["Express","require","uuid","app","ws","use","static","index","clientSockets","req","clientId","send","JSON","stringify","type","NEW_CLIENTS","clients","get","clientList","on","msg","parse","console","log","REGISTER_CLIENT","REGISTERED_ID","uid","newClient","id","label","x","y","addClient","clientMap","Object","values","forEach","clientWs","e","MOVE_CLIENT","client","REPOSITION_CLIENTS","removeClient","REMOVED_CLIENTS","listen","Event","Mice","Model","push","i","length","item","splice","INSTANCE","window"],"mappings":";;;;AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;;;;;;;;ACtCA,4C;;;;;;;;;;ACEA;;AAFA,KAAMA,UAAU,mBAAAC,CAAQ,CAAR,CAAhB;AACA,KAAMC,OAAO,mBAAAD,CAAQ,CAAR,CAAb;;;AAGA,KAAME,MAAM,IAAIH,OAAJ,EAAZ;AACA,KAAMI,KAAK,mBAAAH,CAAQ,CAAR,EAAsBE,GAAtB,CAAX;;AAEAA,KAAIE,GAAJ,CAAQL,QAAQM,MAAR,CAAe,YAAf,CAAR;;AAEA,KAAIC,QAAQ,CAAZ;;AAEA,KAAIC,gBAAgB,EAApB;;AAEAL,KAAIC,EAAJ,CAAO,UAAP,EAAmB,UAASA,EAAT,EAAaK,GAAb,EAAkB;AACnC,OAAIC,WAAWR,MAAf;;AAEAM,iBAAcE,QAAd,IAA0BN,EAA1B;;AAEAA,MAAGO,IAAH,CAAQC,KAAKC,SAAL,CAAe;AACrBC,WAAM,aAAMC,WADS;AAErBC,cAAS,aAAMC,GAAN,GAAYC;AAFA,IAAf,CAAR;;AAKDd,MAAGe,EAAH,CAAM,SAAN,EAAiB,UAASC,GAAT,EAAc;AAC5BA,WAAMR,KAAKS,KAAL,CAAWD,GAAX,CAAN;AACAE,aAAQC,GAAR,CAAY,eAAZ,EAA6BH,GAA7B,EAAkC,aAAMI,eAAxC;AACA,SAAIJ,IAAIN,IAAJ,IAAY,aAAMU,eAAtB,EAAuC;AAAA;AACrCF,iBAAQC,GAAR,CAAY,uBAAZ,EAAqCb,QAArC;AACAN,YAAGO,IAAH,CAAQC,KAAKC,SAAL,CAAe;AACrBC,iBAAM,aAAMW,aADS;AAErBC,gBAAKhB;AAFgB,UAAf,CAAR;;AAKA,aAAIiB,YAAY;AACdC,eAAIlB,QADU;AAEdmB,kBAAOT,IAAIS,KAFG;AAGdC,cAAG,CAHW;AAIdC,cAAG;AAJW,UAAhB;;AAOA,sBAAMd,GAAN,GAAYe,SAAZ,CAAsBL,SAAtB;;AAEAL,iBAAQC,GAAR,CAAYX,KAAKC,SAAL,CAAe,aAAMI,GAAN,GAAYgB,SAA3B,CAAZ;;AAEAC,gBAAOC,MAAP,CAAc3B,aAAd,EAA6B4B,OAA7B,CAAqC,UAASC,QAAT,EAAmB;AACtD,eAAI;AACFA,sBAAS1B,IAAT,CAAcC,KAAKC,SAAL,CAAe;AAC3BC,qBAAM,aAAMC,WADe;AAE3BC,wBAAS,CAACW,SAAD;AAFkB,cAAf,CAAd;AAID,YALD,CAKE,OAAOW,CAAP,EAAU;AACV;AACD;AACF,UATD;AAlBqC;AA4BtC;;AAED,SAAIlB,IAAIN,IAAJ,IAAY,aAAMyB,WAAtB,EAAmC;AAAA;AACjC,aAAIC,SAAS,aAAMvB,GAAN,GAAYgB,SAAZ,CAAsBb,IAAIQ,EAA1B,CAAb;;AAEA,aAAI,CAACY,MAAL,EAAa;AAAE;AACb;AACAlB,mBAAQC,GAAR,CAAY,oBAAZ,EAAkCH,IAAIQ,EAAtC;AACA;AAAA;AAAA;AACD;;AAEDY,gBAAOV,CAAP,GAAWV,IAAIU,CAAf;AACAU,gBAAOT,CAAP,GAAWX,IAAIW,CAAf;;AAEA;AACAG,gBAAOC,MAAP,CAAc3B,aAAd,EAA6B4B,OAA7B,CAAqC,UAASC,QAAT,EAAmB;AACtD,eAAI;AACFA,sBAAS1B,IAAT,CAAcC,KAAKC,SAAL,CAAe;AAC3BC,qBAAM,aAAM2B,kBADe;AAE3BzB,wBAAS,CAAEwB,MAAF;AAFkB,cAAf,CAAd;AAID,YALD,CAKE,OAAOF,CAAP,EAAU,CACX;AACF,UARD;AAbiC;;AAAA;AAsBlC;AACH,IAxDD;;AA0DClC,MAAGe,EAAH,CAAM,OAAN,EAAe,UAASC,GAAT,EAAc;AAC3BE,aAAQC,GAAR,CAAY,8BAAZ,EAA4Cb,QAA5C;AACA,YAAOF,cAAcE,QAAd,CAAP;AACA,kBAAMO,GAAN,GAAYyB,YAAZ,CAAyB,EAACd,IAAIlB,QAAL,EAAzB;;AAEA;AACAwB,YAAOC,MAAP,CAAc3B,aAAd,EAA6B4B,OAA7B,CAAqC,UAASC,QAAT,EAAmB;AACtD,WAAI;AACAA,kBAAS1B,IAAT,CAAc,aAAMgC,eAAN,CAAsB,EAACf,IAAGlB,QAAJ,EAAtB,CAAd;AACH,QAFD,CAEE,OAAO4B,CAAP,EAAU,CACX;AACF,MALD;AAMD,IAZD;AAaD,EAjFD;;AAmFAnC,KAAIyC,MAAJ,CAAW,IAAX,EAAiB,YAAM;AACrBtB,WAAQC,GAAR,CAAY,mBAAZ;AACD,EAFD,E;;;;;;;;;;;;;;;;AC/FO,KAAIsB,wBAAQ;AACf9B,gBAAa,aADE;AAEf4B,oBAAiB,iBAFF;AAGfnB,oBAAiB,iBAHF;AAIfC,kBAAe,eAJA;AAKfc,gBAAa,aALE;AAMfE,uBAAoB;AANL,EAAZ;;KASMK,I,WAAAA,I,GACX,gBAAc;AAAA;;AACZ,QAAKhB,CAAL,GAAS,CAAT;AACA,QAAKC,CAAL,GAAS,CAAT;AACA,QAAKF,KAAL,GAAa,GAAb;AACA,QAAKD,EAAL,GAAU,IAAV;AACD,E;;KAGUmB,K,WAAAA,K;AACX,oBAAc;AAAA;;AACZ,UAAK7B,UAAL,GAAkB,EAAlB;AACA,UAAKe,SAAL,GAAiB,EAAjB;AACD;;;;+BAESO,M,EAAQ;AAChB,WAAI,KAAKP,SAAL,CAAeO,OAAOZ,EAAtB,CAAJ,EAA+B;AAC7B,cAAKc,YAAL,CAAkBF,MAAlB;AACD;;AAED,YAAKtB,UAAL,CAAgB8B,IAAhB,CAAqBR,MAArB;AACA,YAAKP,SAAL,CAAeO,OAAOZ,EAAtB,IAA4BY,MAA5B;AACD;;;kCAEYA,M,EAAQ;AACnB,YAAK,IAAIS,IAAI,CAAb,EAAgBA,IAAI,KAAK/B,UAAL,CAAgBgC,MAApC,EAA4CD,GAA5C,EAAiD;AAC/C,aAAIE,OAAO,KAAKjC,UAAL,CAAgB+B,CAAhB,CAAX;AACA,aAAIE,KAAKvB,EAAL,IAAWY,OAAOZ,EAAtB,EAA0B;AACxB,gBAAKV,UAAL,CAAgBkC,MAAhB,CAAuBH,CAAvB,EAA0B,CAA1B;AACD;AACF;AACD,cAAO,KAAKhB,SAAL,CAAeO,OAAOZ,EAAtB,CAAP;AACD;;;2BAEY;AACX,cAAOmB,MAAMM,QAAb;AACD;;;;;;AAGHN,OAAMM,QAAN,GAAiB,IAAIN,KAAJ,EAAjB;;AAEA,KAAI,OAAOO,MAAP,IAAiB,WAArB,EAAkC;AAC9BA,UAAO,OAAP,IAAkBP,KAAlB;AACH,E;;;;;;ACrDD,qC;;;;;;ACAA,kC;;;;;;ACAA,wC","file":"out/main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 6d2908dfd72a0874e91e","module.exports = require(\"babel-polyfill\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-polyfill\"\n// module id = 1\n// module chunks = 0","const Express = require(\"express\")\nconst uuid = require(\"uuid\")\nimport {Model, Event} from '../shared/Model'\n\nconst app = new Express()\nconst ws = require('express-ws')(app);\n\napp.use(Express.static(\"out/public\"))\n\nvar index = 0;\n\nlet clientSockets = {}\n\napp.ws('/clients', function(ws, req) {\n  var clientId = uuid()\n\n  clientSockets[clientId] = ws\n\n  ws.send(JSON.stringify({\n    type: Event.NEW_CLIENTS,\n    clients: Model.get().clientList\n  }));\n\n\tws.on('message', function(msg) {\n    msg = JSON.parse(msg);\n    console.log(\"new message: \", msg, Event.REGISTER_CLIENT);\n    if (msg.type == Event.REGISTER_CLIENT) {\n      console.log(\"new client registered\", clientId);\n      ws.send(JSON.stringify({\n        type: Event.REGISTERED_ID,\n        uid: clientId\n      }))\n\n      let newClient = {\n        id: clientId,\n        label: msg.label,\n        x: 0,\n        y: 0\n      }\n\n      Model.get().addClient(newClient)\n\n      console.log(JSON.stringify(Model.get().clientMap))\n\n      Object.values(clientSockets).forEach(function(clientWs) {\n        try {\n          clientWs.send(JSON.stringify({\n            type: Event.NEW_CLIENTS,\n            clients: [newClient]\n          }));\n        } catch (e) {\n          // FIXME: implement\n        }\n      });\n    }\n\n    if (msg.type == Event.MOVE_CLIENT) {\n      let client = Model.get().clientMap[msg.id]\n\n      if (!client) { // client is not existing anymore, reconnect\n        // register client normally\n        console.log(\"client not found: \", msg.id);\n        return\n      }\n\n      client.x = msg.x\n      client.y = msg.y\n\n      // notify the other clients that our guy is out\n      Object.values(clientSockets).forEach(function(clientWs) {\n        try {\n          clientWs.send(JSON.stringify({\n            type: Event.REPOSITION_CLIENTS,\n            clients: [ client ]\n          }));\n        } catch (e) {\n        }\n      });\n    }\n\t});\n\n  ws.on('close', function(msg) {\n    console.log('client connection closed for', clientId);\n    delete clientSockets[clientId]\n    Model.get().removeClient({id: clientId})\n\n    // notify the other clients that our guy is out\n    Object.values(clientSockets).forEach(function(clientWs) {\n      try {\n          clientWs.send(Event.REMOVED_CLIENTS[{id:clientId}])\n      } catch (e) {\n      }\n    });\n  });\n});\n\napp.listen(3000, () => {\n  console.log(\"listening on 3000\");\n})\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/main.js","\nexport var Event = {\n    NEW_CLIENTS: \"new-clients\",\n    REMOVED_CLIENTS: \"removed-clients\",\n    REGISTER_CLIENT: \"register-client\",\n    REGISTERED_ID: 'registered-id',\n    MOVE_CLIENT: 'move-client',\n    REPOSITION_CLIENTS: \"reposition-clients\"\n}\n\nexport class Mice {\n  constructor() {\n    this.x = 0;\n    this.y = 0;\n    this.label = \"A\";\n    this.id = null;\n  }\n}\n\nexport class Model {\n  constructor() {\n    this.clientList = []\n    this.clientMap = {}\n  }\n\n  addClient(client) {\n    if (this.clientMap[client.id]) {\n      this.removeClient(client);\n    }\n\n    this.clientList.push(client)\n    this.clientMap[client.id] = client\n  }\n\n  removeClient(client) {\n    for (var i = 0; i < this.clientList.length; i++) {\n      var item = this.clientList[i];\n      if (item.id == client.id) {\n        this.clientList.splice(i, 1);\n      }\n    }\n    delete this.clientMap[client.id];\n  }\n\n  static get() {\n    return Model.INSTANCE\n  }\n}\n\nModel.INSTANCE = new Model()\n\nif (typeof window != \"undefined\") {\n    window[\"Model\"] = Model\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/Model.js","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"uuid\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"uuid\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"express-ws\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express-ws\"\n// module id = 6\n// module chunks = 0"],"sourceRoot":""}